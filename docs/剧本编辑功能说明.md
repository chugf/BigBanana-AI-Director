# 剧本编辑功能说明

## 功能概述

在AI生成剧本和分镜后，系统现在支持手动编辑**角色视觉描述**和**分镜画面提示词**，确保后续在导演工作台生成的图片符合您的预期。

## 功能位置

在 **剧本与故事** 阶段，点击"生成分镜脚本"后，会进入"拍摄清单"视图，在这里可以进行编辑。

---

## 1. 编辑角色视觉描述

### 位置
左侧边栏 → **演员表** 区域

### 操作步骤
1. 将鼠标悬停在任意角色卡片上
2. 点击右侧出现的 **编辑图标** (✏️)
3. 在文本框中修改角色的视觉描述（英文提示词）
4. 点击 **保存** 按钮确认修改，或点击 **取消** 放弃更改

### 作用
- 角色的 `visualPrompt` 会在"素材准备"阶段用于生成角色参考图
- 修改后可以更精确地控制角色的外观、服装、表情等细节
- 确保AI生成的角色图片符合您的预期

### 示例
**原始AI生成：**
```
A young woman in her 20s, casual clothing, friendly expression, photorealistic
```

**修改后：**
```
A young Asian woman in her 20s, wearing a red leather jacket and blue jeans, confident smile, short black hair, photorealistic, cinematic lighting
```

---

## 2. 编辑分镜画面提示词

### 位置
- **桌面端（大屏幕）**：分镜列表右侧的"画面提示词"栏
- **移动端/小屏幕**：分镜详情下方的"画面提示词"区域

### 操作步骤
1. 找到需要修改的分镜
2. 将鼠标悬停在"画面提示词"区域
3. 点击右上角的 **编辑图标** (✏️)
4. 在文本框中修改画面提示词（英文）
5. 点击 **保存** 按钮确认修改，或点击 **取消** 放弃更改

### 作用
- 每个分镜的 `visualPrompt` 会在"导演工作台"用于生成关键帧图像
- 修改后可以精确控制镜头的构图、光线、氛围、动作等
- 确保生成的画面与您的创意意图一致

### 示例
**原始AI生成：**
```
Medium shot of character walking down the street, daytime, live-action style
```

**修改后：**
```
Medium shot of character walking confidently down a rain-soaked urban street at golden hour, neon signs reflecting on wet pavement, shallow depth of field, cinematic composition, live-action style, 8K
```

---

## 3. 最佳实践

### 角色描述编辑建议
- ✅ 包含具体的外观特征（年龄、发型、肤色等）
- ✅ 描述服装和配饰的细节
- ✅ 指定表情和姿态
- ✅ 保持与视觉风格一致（如真人影视、动漫等）
- ❌ 避免过于抽象或模糊的描述

### 画面提示词编辑建议
- ✅ 明确镜头类型（特写、中景、远景等）
- ✅ 描述光线和氛围（金色时刻、霓虹灯、柔和光等）
- ✅ 包含构图细节（景深、角度、对称性等）
- ✅ 指定动作和情绪
- ✅ 保持与项目视觉风格一致
- ❌ 避免冲突的风格描述（如同时要求"真实"和"卡通"）

---

## 4. 编辑后的影响

### 立即生效
修改后的提示词会**立即保存**到项目中，并在以下阶段使用：

1. **素材准备阶段**
   - 角色视觉描述 → 生成角色参考图
   - 场景描述 → 生成场景参考图

2. **导演工作台阶段**
   - 分镜画面提示词 → 生成关键帧图像
   - 结合角色和场景参考图，确保一致性

### 重新生成
如果您已经生成过图片，修改提示词后需要：
1. 进入"素材准备"或"导演工作台"
2. 点击对应素材的 **重新生成** 按钮
3. 系统会使用新的提示词重新生成图片

---

## 5. 技术细节

### 数据结构
```typescript
// 角色
interface Character {
  id: string;
  name: string;
  visualPrompt?: string;  // 可编辑
  // ...
}

// 分镜
interface Shot {
  id: string;
  keyframes: Keyframe[];  // keyframes[0].visualPrompt 可编辑
  // ...
}
```

### 存储
- 所有修改会自动保存到 `localStorage`
- 项目数据实时同步
- 支持撤销（通过重新编辑恢复）

---

## 6. 常见问题

**Q: 修改提示词后，之前生成的图片会自动更新吗？**  
A: 不会。需要手动点击"重新生成"按钮来使用新提示词生成图片。

**Q: 可以批量编辑多个分镜的提示词吗？**  
A: 目前不支持批量编辑，需要逐个修改。未来版本可能会添加此功能。

**Q: 提示词应该用中文还是英文？**  
A: 建议使用**英文**，因为图像生成模型对英文提示词的理解更准确。

**Q: 修改后如何恢复AI原始生成的提示词？**  
A: 目前没有"撤销"按钮，建议在修改前先复制原始提示词保存。

**Q: 编辑功能在移动端可用吗？**  
A: 是的，移动端和小屏幕设备也完全支持编辑功能。

---

## 7. 更新日志

**v1.0 (2025-12-18)**
- ✅ 新增角色视觉描述编辑功能
- ✅ 新增分镜画面提示词编辑功能
- ✅ 支持桌面端和移动端
- ✅ 实时保存，无需手动保存项目

---

## 反馈与建议

如果您在使用过程中遇到问题或有改进建议，欢迎反馈！

