# 镜头连续性功能说明

## 功能概述

在导演工作台中,为每个shot的起始帧(Start)添加了"续接"按钮,可以将上一个shot的结束帧(End)直接作为当前shot的起始帧,提高视频连贯性。

## 使用方法

1. **进入导演工作台**: 在项目的Stage Director阶段
2. **选择任意镜头**: 点击镜头卡片打开右侧详情面板
3. **查找续接按钮**: 
   - 在"起始帧 (Start)"标题右侧
   - 显示为绿色的"← 续接"按钮
4. **使用续接功能**:
   - 点击"← 续接"按钮
   - 系统会自动将上一个镜头的结束帧复制为当前镜头的起始帧

## 功能特点

### 智能判断
- **第一个镜头**: 不显示续接按钮(没有前一个镜头)
- **无结束帧**: 如果上一个镜头还没有生成结束帧,按钮会被禁用(半透明显示)
- **已有结束帧**: 按钮高亮可点击

### 提示信息
- 鼠标悬停在按钮上会显示提示: "使用上一镜头的结束帧"
- 如果上一镜头没有结束帧,点击时会提示: "上一个镜头还没有生成结束帧"

### 数据继承
- **图片URL**: 完整复制上一镜头结束帧的图片
- **提示词**: 继承上一镜头结束帧的visualPrompt
- **状态**: 自动标记为'completed'

## 使用场景

### 1. 连续动作场景
```
Shot 01: 角色向右转身 → End Frame
Shot 02: Start Frame ← 续接 → 角色继续行走
```

### 2. 对话场景
```
Shot 05: 角色A说话结束 → End Frame  
Shot 06: Start Frame ← 续接 → 切换到角色B反应
```

### 3. 运动场景
```
Shot 10: 车辆加速驶出 → End Frame
Shot 11: Start Frame ← 续接 → 车辆驶入新场景
```

## 优势

1. **无缝衔接**: 确保两个镜头之间画面连贯,没有跳跃感
2. **节省资源**: 无需重新生成,直接复用已有图片
3. **提高效率**: 一键操作,快速建立镜头间的连续性
4. **保持一致性**: 自动继承前一帧的视觉风格和提示词

## UI设计

```
起始帧 (Start)              [← 续接] [生成/重新生成]
┌─────────────────┐
│                 │
│   Start Frame   │
│                 │
└─────────────────┘
```

- **按钮颜色**: 翠绿色 (emerald-400) 表示"连接/续接"
- **按钮位置**: 在标题和生成按钮之间
- **禁用状态**: 半透明 + 不可点击

## 技术实现

### 核心函数
```typescript
const handleCopyPreviousEndFrame = () => {
  // 1. 检查是否是第一个镜头
  // 2. 获取上一个镜头的结束帧
  // 3. 验证结束帧是否存在
  // 4. 创建新的起始帧对象
  // 5. 更新当前镜头的keyframes
}
```

### 数据流
```
Previous Shot → End Keyframe (imageUrl, visualPrompt)
                      ↓
              handleCopyPreviousEndFrame()
                      ↓
Current Shot → Start Keyframe (复制的数据)
```

## 注意事项

1. **不会自动生成**: 续接功能只是复制,不会触发AI生成
2. **可以覆盖**: 即使已经有起始帧,也可以用续接功能覆盖
3. **单向操作**: 不能撤销,但可以重新生成新的起始帧
4. **保留原提示词**: 复制的起始帧会保留原结束帧的提示词

## 工作流建议

### 推荐流程
1. 生成第一个镜头的起始帧和结束帧
2. 对于后续镜头:
   - 如果需要连贯性 → 使用"续接"
   - 如果是新场景/跳切 → 使用"生成"

### 批量操作
- 先生成所有镜头的结束帧
- 然后从第二个镜头开始,逐个使用"续接"功能
- 这样可以确保整个项目的视觉连贯性
