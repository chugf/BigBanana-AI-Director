# 项目删除功能测试清单

## 测试目的
验证删除项目时，所有相关资源（包括Base64格式的媒体文件）都能正确清理。

## 测试准备

### 创建测试项目
1. 创建新项目
2. 输入测试剧本
3. 生成剧本数据（角色、场景）
4. 生成部分资产（至少1个角色参考图、1个场景参考图）
5. 生成部分分镜（至少2个关键帧、1个视频）

### 记录初始状态
- [ ] 打开浏览器开发者工具 (F12)
- [ ] 进入 Application → Storage → IndexedDB → BigBananaDB
- [ ] 记录数据库大小
- [ ] 截图或记录项目列表

## 功能测试

### 1. 删除确认对话框测试

#### 测试步骤
1. 在项目卡片上悬停
2. 点击删除按钮（垃圾桶图标）
3. 观察确认对话框

#### 预期结果
- [ ] 对话框正确显示
- [ ] 显示警告图标
- [ ] 显示 "确认删除项目？" 标题
- [ ] 显示 "此操作无法撤销" 警告
- [ ] 列出将被删除的资源类型：
  - [ ] 角色和场景参考图
  - [ ] 所有关键帧图像
  - [ ] 所有生成的视频片段
  - [ ] 渲染历史记录
- [ ] 显示两个按钮："取消" 和 "永久删除"

### 2. 取消删除测试

#### 测试步骤
1. 触发删除确认对话框
2. 点击 "取消" 按钮
3. 观察结果

#### 预期结果
- [ ] 对话框关闭
- [ ] 项目仍然存在于列表中
- [ ] 项目数据完整无损
- [ ] 控制台无错误信息

### 3. 执行删除测试

#### 测试步骤
1. 打开浏览器控制台 (F12 → Console)
2. 触发删除确认对话框
3. 点击 "永久删除" 按钮
4. 观察控制台输出和界面变化

#### 预期结果

**控制台日志**
- [ ] 显示 `🗑️ 开始删除项目: proj_xxxxx`
- [ ] 显示 `✅ 项目已删除: [项目名称]`
- [ ] 显示 `📊 清理的资源统计:`
- [ ] 正确统计各类资源数量：
  ```
  - 角色参考图: X个
  - 角色变体图: X个
  - 场景参考图: X个
  - 关键帧图像: X个
  - 视频片段: X个
  - 渲染日志: X条
  ```
- [ ] 显示 `💾 重新加载项目列表...`
- [ ] 显示 `✅ 项目 "XXX" 已成功删除`

**界面变化**
- [ ] 项目从列表中消失
- [ ] 项目列表正确刷新
- [ ] 无错误提示
- [ ] 页面布局正常

### 4. 数据库清理验证

#### 测试步骤
1. 打开 Application → Storage → IndexedDB → BigBananaDB → projects
2. 检查项目记录
3. 检查数据库大小变化

#### 预期结果
- [ ] 项目记录已被删除
- [ ] 数据库中找不到该项目ID
- [ ] 数据库大小减少（可能不会立即显示）

### 5. 存储空间验证

#### 测试步骤（Chrome）
1. 访问 `chrome://settings/content/all`
2. 搜索网站域名
3. 查看存储使用情况

#### 预期结果
- [ ] 存储使用量减少（可能延迟几分钟）
- [ ] 无异常存储占用

## 边界情况测试

### 6. 删除空项目

#### 测试步骤
1. 创建新项目但不生成任何资源
2. 立即删除该项目

#### 预期结果
- [ ] 删除成功
- [ ] 控制台显示所有资源数量为 0
- [ ] 无错误信息

### 7. 删除大型项目

#### 测试步骤
1. 创建包含大量资源的项目：
   - 10+ 个角色参考图
   - 10+ 个场景参考图
   - 50+ 个关键帧
   - 10+ 个视频片段
2. 删除该项目

#### 预期结果
- [ ] 删除操作在合理时间内完成（< 2秒）
- [ ] 控制台正确统计所有资源
- [ ] 界面响应正常
- [ ] 无内存溢出或卡顿

### 8. 连续删除多个项目

#### 测试步骤
1. 创建3个测试项目
2. 依次快速删除这3个项目

#### 预期结果
- [ ] 所有项目都能正确删除
- [ ] 每次删除都有独立的日志输出
- [ ] 项目列表正确更新
- [ ] 无冲突或错误

### 9. 删除当前打开的项目

#### 测试步骤
1. 打开一个项目（进入编辑界面）
2. 返回Dashboard
3. 删除刚才打开的项目

#### 预期结果
- [ ] 删除成功
- [ ] 无错误提示
- [ ] 如果再次尝试打开该项目，应显示 "项目不存在" 错误

## 错误处理测试

### 10. 网络断开测试

#### 测试步骤
1. 打开开发者工具
2. Network → Offline
3. 尝试删除项目

#### 预期结果
- [ ] 删除操作仍能完成（因为是本地操作）
- [ ] 控制台有正确的日志
- [ ] 项目被成功删除

### 11. 无效项目ID测试

#### 测试步骤（需要修改代码测试）
```javascript
// 在控制台执行
deleteProjectFromDB('invalid_id_12345')
  .then(() => console.log('Success'))
  .catch(err => console.error('Error:', err))
```

#### 预期结果
- [ ] 操作完成但无实际删除
- [ ] 控制台显示警告：`无法加载项目信息，直接删除`
- [ ] 无严重错误

## 性能测试

### 12. 删除耗时测试

#### 测试步骤
1. 在控制台记录时间：
   ```javascript
   console.time('delete');
   // 点击删除按钮
   // 等待删除完成
   console.timeEnd('delete');
   ```

#### 预期结果
- [ ] 小型项目（< 50资源）：< 100ms
- [ ] 中型项目（50-200资源）：< 300ms
- [ ] 大型项目（> 200资源）：< 1000ms

### 13. 内存泄漏测试

#### 测试步骤
1. 打开 Performance Monitor (Shift + Cmd/Ctrl + P → "Performance Monitor")
2. 记录初始内存使用
3. 删除10个项目
4. 强制垃圾回收（Console → 垃圾桶图标）
5. 观察内存使用

#### 预期结果
- [ ] 内存使用恢复到初始水平
- [ ] 无明显内存泄漏

## 用户体验测试

### 14. 提示信息清晰度

#### 测试人员反馈
- [ ] 删除确认对话框的警告是否足够清晰？
- [ ] 资源列表是否易于理解？
- [ ] 按钮标签是否明确？
- [ ] 是否需要额外的成功提示？

### 15. 操作流畅度

#### 测试步骤
连续进行多次删除操作

#### 预期结果
- [ ] 操作响应迅速
- [ ] 动画流畅无卡顿
- [ ] 界面刷新及时

## 兼容性测试

### 16. 浏览器兼容性

测试浏览器：
- [ ] Chrome/Edge (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (如果可用)

各浏览器预期结果：
- [ ] 删除功能正常
- [ ] 控制台日志正确
- [ ] IndexedDB正确清理

## 测试结果记录

### 测试环境
- 日期：__________
- 浏览器：__________
- 版本：__________
- 操作系统：__________

### 测试总结

#### 通过的测试项
```
列出通过的测试编号和名称
```

#### 失败的测试项
```
列出失败的测试编号、名称和失败原因
```

#### 发现的问题
```
1. 问题描述
   - 复现步骤
   - 预期行为
   - 实际行为
   - 严重程度
```

#### 改进建议
```
列出可以改进的地方
```

## 回归测试

在以下情况发生后，应重新运行此测试清单：
- [ ] 修改 deleteProjectFromDB 函数
- [ ] 修改 Dashboard 删除UI
- [ ] 修改项目数据结构
- [ ] 修改 IndexedDB schema
- [ ] 浏览器版本更新

## 自动化测试建议

未来可以考虑添加自动化测试：

```typescript
describe('Project Deletion', () => {
  it('should delete project and all resources', async () => {
    const project = await createTestProject();
    await deleteProjectFromDB(project.id);
    
    expect(await projectExists(project.id)).toBe(false);
  });
  
  it('should log resource statistics', async () => {
    const consoleSpy = jest.spyOn(console, 'log');
    await deleteProjectFromDB('test_id');
    
    expect(consoleSpy).toHaveBeenCalledWith(
      expect.stringContaining('清理的资源统计')
    );
  });
});
```

---

**测试完成签名**

测试人员：__________  
日期：__________  
结果：✅ 通过 / ⚠️ 部分通过 / ❌ 失败
