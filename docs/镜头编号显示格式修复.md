# 镜头编号显示格式修复说明

## 🎯 问题描述

**原问题**：拆分后的镜头编号显示不符合预期

- **期望格式**：`SHOT 001-1`、`SHOT 001-2`、`SHOT 001-3`
- **实际显示**：`SHOT 001`、`SHOT 002`、`SHOT 003`（基于数组索引的连续编号）

## 📊 问题分析

### 原有逻辑问题

**ShotCard.tsx**：
```typescript
// ❌ 原有逻辑：基于数组索引
SHOT {String(index + 1).padStart(2, '0')}
```

这会导致：
- 原镜头 `shot-1` 在索引 0 → 显示 `SHOT 01` ✅
- 拆分后 `shot-1-1` 在索引 0 → 显示 `SHOT 01` ❌（应该是 `SHOT 001-1`）
- 拆分后 `shot-1-2` 在索引 1 → 显示 `SHOT 02` ❌（应该是 `SHOT 001-2`）
- 拆分后 `shot-1-3` 在索引 2 → 显示 `SHOT 03` ❌（应该是 `SHOT 001-3`）

### 数据结构

拆分功能生成的子镜头ID格式：
- 原镜头：`shot-1`, `shot-2`, `shot-3`
- 子镜头：`shot-1-1`, `shot-1-2`, `shot-1-3`

## ✅ 解决方案

从 `shot.id` 中解析并提取正确的编号格式，而不是依赖数组索引。

### 实现逻辑

```typescript
// 从shot.id中提取显示编号
const getShotDisplayNumber = () => {
  const idParts = shot.id.split('-').slice(1); // 移除 "shot" 前缀
  
  if (idParts.length === 1) {
    // 主镜头：shot-1 → "SHOT 001"
    return `SHOT ${String(idParts[0]).padStart(3, '0')}`;
  } else if (idParts.length === 2) {
    // 子镜头：shot-1-1 → "SHOT 001-1"
    return `SHOT ${String(idParts[0]).padStart(3, '0')}-${idParts[1]}`;
  } else {
    // 降级方案：使用index（兼容性处理）
    return `SHOT ${String(index + 1).padStart(3, '0')}`;
  }
};
```

## 🔧 修改内容

### 1. ShotCard.tsx

**修改位置**：镜头卡片的标题显示

**修改前**：
```typescript
<span className={`font-mono text-[10px] font-bold ${isActive ? 'text-indigo-400' : 'text-zinc-500'}`}>
  SHOT {String(index + 1).padStart(2, '0')}
</span>
```

**修改后**：
```typescript
<span className={`font-mono text-[10px] font-bold ${isActive ? 'text-indigo-400' : 'text-zinc-500'}`}>
  {getShotDisplayNumber()}
</span>
```

### 2. ShotWorkbench.tsx

**修改位置**：右侧工作台的镜头编号显示

**修改前**：
```typescript
<span className="w-8 h-8 bg-indigo-900/30 text-indigo-400 rounded-lg flex items-center justify-center font-bold font-mono text-sm border border-indigo-500/20">
  {String(shotIndex + 1).padStart(2, '0')}
</span>
```

**修改后**：
```typescript
<span className="w-8 h-8 bg-indigo-900/30 text-indigo-400 rounded-lg flex items-center justify-center font-bold font-mono text-sm border border-indigo-500/20">
  {getShotDisplayNumber()}
</span>
```

**注意**：工作台中的显示格式略有不同：
- 主镜头：`01`（2位数）
- 子镜头：`01-1`（带子序号）

## 📋 显示效果对比

### 修改前 ❌

拆分 `SHOT 001` 后：
```
SHOT 001  （原镜头，索引0）
SHOT 002  （子镜头1，索引1）❌ 应该是 001-1
SHOT 003  （子镜头2，索引2）❌ 应该是 001-2
SHOT 004  （子镜头3，索引3）❌ 应该是 001-3
SHOT 005  （下一个原镜头，索引4）❌ 应该是 002
```

### 修改后 ✅

拆分 `SHOT 001` 后：
```
SHOT 001-1  （子镜头1）✅
SHOT 001-2  （子镜头2）✅
SHOT 001-3  （子镜头3）✅
SHOT 002    （下一个原镜头）✅
```

## 🎬 实际使用场景

### 场景1：未拆分的镜头列表

```
SHOT 001  - 主角走进房间
SHOT 002  - 主角打开灯
SHOT 003  - 主角坐下
```

### 场景2：拆分 SHOT 001 后

```
SHOT 001-1  - 全景：主角从门口走向房间中央
SHOT 001-2  - 中景：主角的脚步特写
SHOT 001-3  - 近景：主角的面部表情
SHOT 002    - 主角打开灯
SHOT 003    - 主角坐下
```

### 场景3：拆分多个镜头后

```
SHOT 001-1  - 全景：主角从门口走向房间中央
SHOT 001-2  - 中景：主角的脚步特写
SHOT 001-3  - 近景：主角的面部表情
SHOT 002-1  - 中景：手伸向电灯开关
SHOT 002-2  - 特写：手指触碰开关
SHOT 002-3  - 全景：房间亮起
SHOT 003    - 主角坐下（未拆分）
```

## 🧪 测试验证

### 测试点1：显示格式正确性
- [ ] 主镜头显示为 `SHOT 001`、`SHOT 002` 等
- [ ] 子镜头显示为 `SHOT 001-1`、`SHOT 001-2` 等
- [ ] 编号格式在 ShotCard 和 ShotWorkbench 中一致

### 测试点2：拆分后编号连续性
- [ ] 拆分 SHOT 001 后，下一个原镜头仍然是 SHOT 002
- [ ] 拆分多个镜头后，编号体系保持清晰

### 测试点3：兼容性
- [ ] 对于非标准ID格式，降级方案正常工作
- [ ] 编号显示不会出错或崩溃

## 💡 技术细节

### ID解析算法

```typescript
shot.id.split('-')  // ["shot", "1", "2"]
  .slice(1)         // ["1", "2"] - 移除 "shot" 前缀
```

**示例**：
- `"shot-1"` → `["1"]` → `"SHOT 001"`
- `"shot-1-1"` → `["1", "1"]` → `"SHOT 001-1"`
- `"shot-1-2"` → `["1", "2"]` → `"SHOT 001-2"`
- `"shot-10-3"` → `["10", "3"]` → `"SHOT 010-3"`

### 降级方案

如果 ID 格式不符合预期（例如手动修改或旧数据），使用索引作为降级方案：
```typescript
return `SHOT ${String(index + 1).padStart(3, '0')}`;
```

## 📝 总结

✅ **问题已修复**：拆分后的镜头编号格式符合预期

✅ **显示一致性**：ShotCard 和 ShotWorkbench 都使用正确的格式

✅ **用户体验提升**：编号体系清晰，易于识别主镜头和子镜头的关系

✅ **兼容性保证**：包含降级方案，处理非标准ID格式

---

**修改文件清单**：
1. ✅ `components/StageDirector/ShotCard.tsx` - 镜头卡片显示
2. ✅ `components/StageDirector/ShotWorkbench.tsx` - 工作台显示

**无linter错误** ✅

现在拆分后的镜头编号会正确显示为 `SHOT 001-1`、`SHOT 001-2`、`SHOT 001-3` 的格式！

